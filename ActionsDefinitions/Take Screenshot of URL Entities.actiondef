{"Name":"Take Screenshot of URL Entities","Description":"","Script":"from SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime, output_handler\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED,EXECUTION_STATE_TIMEDOUT\nimport requests\nimport json\nimport sys\n\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n\n    #url_list = siemplify.extract_action_param(\"URL(s)\", print_value=True)\n    html_output = siemplify.extract_action_param(\"HTML Format Output?\", print_value=True)\n\n    base64_list = []\n    output = \"\"\n\n    for entity in siemplify.target_entities:\n        if \"https://\" in entity.identifier.lower() or \"http://\" in entity.identifier.lower():\n            siemplify.LOGGER.info(entity.identifier)\n            if \".onion\" in entity.identifier.lower():\n                siemplify.LOGGER.info(\"Skipping \" + entity.identifier.lower() + \" as TOR URL detected.\")\n            else:\n                b = take_screenshot(entity.identifier)\n                s = {\n                    \"url\" : entity.identifier.lower(),\n                    \"screenshot\" : b\n                }\n                base64_list.append(s)\n\n    if html_output == True or html_output == 'true' or html_output == \"True\":\n        for s in base64_list:\n            html_image = \"<h1>\" + s['url'] + \"</h1>\"\n            html_image = html_image + \"<img src=\\\"data:image/png;base64,\"+ s['screenshot'] +\"\\\">\"\n            output = output + html_image + \"\\n\"\n    else:\n        for s in base64_list:\n            output = output + s['screenshot'] + \"\\n\"\n\n\n    status = EXECUTION_STATE_COMPLETED\n    output_message = str(len(base64_list)) + \" screenshot(s) taken\"\n    result_value = output\n    siemplify.result.add_result_json(base64_list)\n\n    siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n    siemplify.end(output_message, result_value, status)\n\ndef take_screenshot(url):\n    res = requests.get(url=\"http://10.22.83.205:5000/screenshot?url=\" + url)\n    js = res.json()\n    return js['screenshot']\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"Screenshot Service","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{}","ShowResult":true}],"Creator":"036fe879-4c16-461e-b6d9-b1c552806fa0","IsEnabled":true,"IsCustom":true,"IsSystem":false,"Version":31.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"false","Description":"Result will return images with proper \"img\" HTML tags","Name":"HTML Format Output?","Value":"false","Type":1,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","SimulationData":{"Entities":null},"SimulationDataJson":null}