{"Name":"Take Screenshot","Description":"","Script":"from SiemplifyAction import SiemplifyAction\nfrom SiemplifyUtils import unix_now, convert_unixtime_to_datetime, output_handler\nfrom ScriptResult import EXECUTION_STATE_COMPLETED, EXECUTION_STATE_FAILED,EXECUTION_STATE_TIMEDOUT\nimport requests\nimport json\n\n\n\n@output_handler\ndef main():\n    siemplify = SiemplifyAction()\n\n    url_list = siemplify.extract_action_param(\"URL(s)\", print_value=True)\n    html_output = siemplify.extract_action_param(\"HTML Format Output?\", print_value=True)\n\n    base64_list = []\n    output = \"\"\n\n    if ',' in url_list:\n        siemplify.LOGGER.info('Detected multiple URLs to screenshot')\n        obj = url_list.split(',')\n        for i in obj:\n            b = take_screenshot(i)\n            s = {\n                \"url\" : i,\n                \"screenshot\" : b\n            }\n            base64_list.append(s)\n    else:\n        siemplify.LOGGER.info('Single URL detected to screenshot')\n        b = take_screenshot(url_list)\n        s = {\n                \"url\" : url_list,\n                \"screenshot\" : b\n        }\n        base64_list.append(s)\n\n    siemplify.LOGGER.info(str(len(base64_list)) + ' screenshot(s) taken.')\n\n    if html_output == True or html_output == 'true' or html_output == \"True\":\n        for s in base64_list:\n            html_image = \"<h1>\" + s['url'] + \"</h1>\"\n            html_image = html_image + \"<img src=\\\"data:image/png;base64,\"+ s['screenshot'] +\"\\\">\"\n            output = output + html_image + \"\\n\"\n    else:\n        for s in base64_list:\n            output = output + str(s) + \"\\n\"\n\n\n    status = EXECUTION_STATE_COMPLETED\n    output_message = str(len(base64_list)) + \" screenshot(s) taken\"\n    result_value = output\n\n    siemplify.LOGGER.info(\"\\n  status: {}\\n  result_value: {}\\n  output_message: {}\".format(status,result_value, output_message))\n    siemplify.end(output_message, result_value, status)\n\ndef take_screenshot(url):\n    res = requests.get(url=\"http://10.22.83.205:5000/screenshot?url=\" + url)\n    js = res.json()\n    return js['screenshot']\n\nif __name__ == \"__main__\":\n    main()\n","IntegrationIdentifier":"Screenshot Service","ScriptResultName":"ScriptResult","DynamicResultsMetadata":[{"ResultName":"JsonResult","ResultExample":"{}","ShowResult":false}],"Creator":"036fe879-4c16-461e-b6d9-b1c552806fa0","IsEnabled":true,"IsCustom":true,"IsSystem":false,"Version":21.0,"TimeoutSeconds":600,"IsAsync":false,"AsyncPollingIntervalInSeconds":3600,"TotalIntervalTimeoutForAsyncInSeconds":86400,"Parameters":[{"CustomActionId":0,"IsMandatory":true,"DefaultValue":"https://cloud.google.com/security/products/security-operations?hl=en","Description":"URL or list of URLs (comma-separated) to take a screenshot of","Name":"URL(s)","Value":"https://cloud.google.com/security/products/security-operations?hl=en","Type":0,"OptionalValues":null,"OptionalValuesJson":null},{"CustomActionId":0,"IsMandatory":false,"DefaultValue":"false","Description":"Result will return images with proper \"img\" HTML tags","Name":"HTML Format Output?","Value":"false","Type":1,"OptionalValues":null,"OptionalValuesJson":null}],"DefaultResultValue":"","PythonVersion":"None","SimulationData":{"Entities":null},"SimulationDataJson":null}